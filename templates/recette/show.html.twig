{% extends 'base.html.twig' %}

{% block title %}Détails de la Recette{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    
    <p><a href="{{ path('recette.index') }}">Retour à la indexe des recettes</a></p>

    {% if recette is not empty %}

     <h1>{{ recette.user.pseudo }} <a href="{{ path('recette.following', {id: recette.id})  }}">suivre </a></h1> <h1><small>Posté le {{ recette.createAt | date('d-m-Y H:i') }}</small></p>
        <h1>{{ recette.titre }}</h1>
        <p><img src="/recettes/images/{{ recette.photo }}" alt="{{ recette.titre }}" style="max-width:100%; height:auto;"></p>


        {% set userHasLiked = false %}
        {% for like in recette.likeRecettes %}
            {% if like.user == app.user %}
                {% set userHasLiked = true %}
            {% endif %}
        {% endfor %}

        {% if userHasLiked %}
        
            <form action="{{ path('recette.like', {id: recette.id}) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-secondary">👎 Retirer le Like</button>
            </form>
        {% else %}
            <form action="{{ path('recette.like', {id: recette.id}) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-primary">👍 Ajouter un Like</button>
            </form>
        {% endif %}

                {% if userHasLiked %}
        
            <form action="{{ path('recette.sauvegarder', {id: recette.id}) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-secondary">👎 Retirer Liste des favoris</button>
            </form>
        {% else %}
            <form action="{{ path('recette.sauvegarder', {id: recette.id}) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-primary">👍 Ajouter aux favoris</button>
            </form>
        {% endif %}
        
        {{ form(form, {'method': 'POST'}) }}
        
    {% else %}
        <p>Recette introuvable.</p>
    {% endif %}

    <h2>Jaime {{ nbLike }} </h2>
    <h2>Commentaires {{ nbCommentaire }} </h2>    
    {% if commentaires is not empty %}
    <ul>
        {% for commentaire in commentaires %}
            <li>
                <p> <img src="#" alt="#" style="max-width:10%; height:10;">
                 {{ commentaire.user.pseudo }}</p>
                <p>{{ commentaire.commentaire }}</p>
                <small>Posté le {{ commentaire.createAt | date('d-m-Y H:i') }}</small>
                
                {# Vérifiez si l'user connecté est l'auteur du commentaire #}
                {% if commentaire.user.id == app.user.id %}

                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Aucun commentaire pour cette recette.</p>
{% endif %}
</div>
{% endblock %}